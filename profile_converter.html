<html>
	<body>
		<script type="text/javascript" src="jszip.min.js"></script>
		<script type="text/javascript" src="converter.inc.js"></script>
		<script type="text/javascript">
			"use strict";

			// To get a drop event we have to cancel dragover:
			document.addEventListener('dragover', function (e) { e.preventDefault(); }, false);

			document.addEventListener('drop', function (e) {

				e.preventDefault();

				document.querySelector('[data-bind=instructions]').innerHTML = 'Working...';
				document.querySelector('[data-bind=progressbar]').value = 0;
				document.querySelector('[data-bind=progressbar]').style.display = '';


				var reader = new FileReader();
				reader.onload = function (e)
				{
					var filename;

					var input = new Uint8Array(e.target.result);

					converter.convert(input, function(output) {

						var link = document.createElement('a');
						//noinspection JSUnresolvedFunction
						link.href = window.URL.createObjectURL(new Blob([JSON.stringify(output)], {type: 'text/plain'}));
						link.download = "PHP.cpuprofile";
						link.click();

						document.querySelector('[data-bind=progressbar]').style.display = 'none';
						document.querySelector('[data-bind=instructions]').innerHTML = 'Finished. Open Chrome Developer Tools and load the downloaded files on the Profiles tab. Or drop the next file here.';

					}, function (progress) {
						document.querySelector('[data-bind=progressbar]').value = progress;
					});
				};
				reader.readAsArrayBuffer(e.dataTransfer.files[0]);

			}, false);
		</script>
		<span class="instructions" data-bind="instructions">Drop Xdebug profile here</span>
		<progress value="0" max="100" style="display: none;" data-bind="progressbar"></progress>
	</body>
</html>
